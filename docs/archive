# FOUND THE BUG! üêõ

## Problem
**Individual LED panel tests (11-18) fail, but group patterns (1-11) work**

## Root Cause
ESP32 firmware **inverts X and Y coordinates** in the `XY()` function:

```cpp
// Line 86-87 in mirror-prod-animation_esp32.ino
uint8_t cx = TOTAL_W - 1 - x;  // FLIPS X coordinate
uint8_t cy = TOTAL_H - 1 - y;  // FLIPS Y coordinate
```

## Impact
- When Python sends panel 1 data (top-left): Y[0:16], X[0:16]
- ESP32 inverts to: Y[48:64], X[16:32] = **Panel 8 (bottom-right)**!

**Mapping:**
- Panel 1 (sent) ‚Üí Panel 8 (displayed)
- Panel 2 (sent) ‚Üí Panel 7 (displayed)  
- Panel 3 (sent) ‚Üí Panel 6 (displayed)
- Panel 4 (sent) ‚Üí Panel 5 (displayed)
- Panel 5 (sent) ‚Üí Panel 4 (displayed)
- Panel 6 (sent) ‚Üí Panel 3 (displayed)
- Panel 7 (sent) ‚Üí Panel 2 (displayed)
- Panel 8 (sent) ‚Üí Panel 1 (displayed)

## Why Group Patterns Work
- **Brightness levels**: Symmetric gradient (30‚Üí255) becomes (255‚Üí30), still shows panels
- **Checkerboard**: Symmetric pattern looks the same
- **Gradient**: Horizontal gradient just reverses direction
- **Full patterns**: Fill entire display, so inversion doesn't matter

## Why Individual Panels Fail
- Send "Panel 1 only" ‚Üí Displays on wrong physical position
- Confusing because it DOES light up, just the WRONG panel!

##  Solutions

### Option 1: Fix Python Code (Invert Before Sending)
Flip the pattern before sending to match ESP32's expectation:

```python
# In pack_led_packet() or pattern generation
pattern_flipped = np.flip(np.flip(pattern, axis=0), axis=1)  # Flip Y then X
```

### Option 2: Fix ESP32 Firmware (Remove Inversion)
```cpp
// Change lines 86-87 to:
uint8_t cx = x;  // Don't invert X
uint8_t cy = y;  // Don't invert Y
```

### Option 3: Document the Inversion
Keep it as-is, but document that:
- Panel numbering in Python is inverted vs physical
- Panel 1 in code = Panel 8 physically

## Recommended Fix
**Fix Python side** - easier to modify without re-flashing ESP32!

Add inversion to `LEDPanelTester` generation functions.
